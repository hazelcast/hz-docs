= Best Practices

The following practices help improve test reliability, execution speed, and reproducibility when writing tests for Hazelcast powered applications.

== Test Isolation

- Use randomly generated cluster names to avoid clashes between instances meant to belong to different clusters, especially when running tests concurrently.
- Always clean up resources after each test using `factory.shutdownAll()` or `Hazelcast.shutdownAll()` in a teardown hook.

== Cluster Configuration

- Use mock networking for tests by default; it avoids the need for real sockets and speeds up execution.
- Reserve real networking setups for network integration or system tests only.
- Keep test clusters small (e.g., 2â€“3 nodes) to validate partitioning, replication, and quorum logic efficiently.
- Assert cluster size explicitly using `assertClusterSizeEventually(...)` before testing distributed operations relying on fully formed clusters.

== Managing Flakiness

- Use `@Repeat` to identify and eliminate sources of flakiness.
- Enable thread dump logging on failure by setting `hazelcast.test.threadDumpOnFailure=true`.

== Hazelcast Test Properties

The following system properties can be configured to fine-tune test behaviour:

- `hazelcast.test.use.network=false`: This is the default value to use mock networking. Set to `true` to use real networking.
- `hazelcast.test.threadDumpOnFailure=true`: Print thread dumps when a test fails to aid debugging.
- `hazelcast.phone.home.enabled=false`: Disable phone-home feature for clean test output.
- `hazelcast.wait.seconds.before.join=1`: Reduce wait time before a member attempts to join the cluster.
- `hazelcast.local.localAddress=127.0.0.1`: Bind test members to the loopback address to avoid conflicts.
- `java.net.preferIPv4Stack=true`: Ensure consistent networking on dual-stack systems.

== Miscellaneous

- Test execution durations are printed automatically when using `HazelcastParallelClassRunner` or `HazelcastSerialClassRunner`.

When using `HazelcastParallelClassRunner` and tests fails with an error in initialization about client or instances aren't shutdown, some (other) tests may not properly shutdown the client/instances created. Make sure your tests do so.